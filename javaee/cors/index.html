<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.18.1" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" href="http://hugo.xizero.com//index.xml" type="application/rss+xml" title="XIZERO">
<link href="http://hugo.xizero.com/css/block.css" rel="stylesheet">
<script src="http://hugo.xizero.com/js/jqury.min.js"></script>
<script src="http://hugo.xizero.com/js/top.js"></script>


<title>CORS - XIZERO</title>
</head>
<body>

<div id="gotop" title="ğŸš€ go top"></div>


<div class="titlist">
	<span><a href="http://hugo.xizero.com/">Home</a></span>
	<span><a href="http://hugo.xizero.com//tags/">Tags</a></span>
	<span><a href="http://hugo.xizero.com//about">About</a></span>
</div>



<link href="http://hugo.xizero.com/css/context.css" rel="stylesheet">
<link href="http://hugo.xizero.com/css/tomorrow.min.css" rel="stylesheet">
<script src="http://hugo.xizero.com/js/high.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<div class="tit">
	CORS
</div>

<div class="toc">
	<nav id="TableOfContents">
<ul>
<li><a href="#cors">CORS</a>
<ul>
<li><a href="#å…³äºè·¨åŸŸè¯·æ±‚">å…³äºè·¨åŸŸè¯·æ±‚</a></li>
<li><a href="#cors-è¿‡ç¨‹ç†è§£">CORS è¿‡ç¨‹ç†è§£</a></li>
<li><a href="#cors-è¯·æ±‚">CORS è¯·æ±‚</a>
<ul>
<li><a href="#ç®€å•è¯·æ±‚">ç®€å•è¯·æ±‚</a></li>
<li><a href="#é¢„è¯·æ±‚">é¢„è¯·æ±‚</a></li>
</ul></li>
<li><a href="#http-è¯·æ±‚å¤´">HTTP è¯·æ±‚å¤´</a>
<ul>
<li><a href="#origin">Origin</a></li>
<li><a href="#access-control-request-method">Access-Control-Request-Method</a></li>
<li><a href="#access-control-request-headers">Access-Control-Request-Headers</a></li>
</ul></li>
<li><a href="#http-å“åº”å¤´">HTTP å“åº”å¤´</a>
<ul>
<li><a href="#access-control-allow-origin">Access-Control-Allow-Origin</a></li>
<li><a href="#access-control-expose-headers">Access-Control-Expose-Headers</a></li>
<li><a href="#access-control-max-age">Access-Control-Max-Age</a></li>
<li><a href="#access-control-allow-credentials">Access-Control-Allow-Credentials</a></li>
<li><a href="#access-control-allow-methods">Access-Control-Allow-Methods</a></li>
<li><a href="#access-control-allow-headers">Access-Control-Allow-Headers</a></li>
</ul></li>
<li><a href="#åœ¨æœåŠ¡å™¨ç«¯æ”¯æŒ-cors">åœ¨æœåŠ¡å™¨ç«¯æ”¯æŒ CORS</a>
<ul>
<li><a href="#åœ¨-tomcat-ä¸­è®¾ç½®-cors">åœ¨ tomcat ä¸­è®¾ç½® CORS</a></li>
<li><a href="#åœ¨-nginx-ä¸­è®¾ç½®-cors">åœ¨ nginx ä¸­è®¾ç½® CORS</a></li>
<li><a href="#åœ¨-java-web-é¡¹ç›®ä¸­è‡ªå®šä¹‰-cors-è¿‡æ»¤å™¨">åœ¨ java web é¡¹ç›®ä¸­è‡ªå®šä¹‰ CORS è¿‡æ»¤å™¨</a></li>
</ul></li>
<li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
</ul></li>
</ul>
</nav>
</div>

<div class="con">
	

<h1 id="cors">CORS</h1>

<p>è·¨åŸŸèµ„æºå…±äº« ï¼ŒCross-Origin Resource Sharing ï¼Œç®€ç§° CORSã€‚</p>

<p>ä½¿ç”¨ XMLHttpRequest å¯¹è±¡å’ŒFetchå‘èµ· HTTP è¯·æ±‚å°±å¿…é¡»éµå®ˆåŒæºç­–ç•¥ï¼ŒCORS æ˜¯HTML5 çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆã€‚</p>

<p>äº†è§£æ›´å¤šï¼Œå‚é˜…ï¼š<a href="https://www.w3.org/TR/cors/">https://www.w3.org/TR/cors/</a></p>

<h2 id="å…³äºè·¨åŸŸè¯·æ±‚">å…³äºè·¨åŸŸè¯·æ±‚</h2>

<p>ç†è§£ä¸Šï¼Œè·¨åŸŸè¯·æ±‚ä¸æ˜¯è¢«æœåŠ¡å™¨æ‹’ç»ï¼Œè€Œæ˜¯<strong>è¿”å›ç»“æœè¢«æµè§ˆå™¨æ‹¦æˆª</strong>äº†ï¼Œè¢«æ‹’ç»çš„ç»“æœå¯ä»¥åœ¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹ã€‚</p>

<p>å…¶å®ƒï¼Œæœ‰äº›æµè§ˆå™¨ä¸å…è®¸ä»HTTPSçš„åŸŸè·¨åŸŸè®¿é—®HTTPï¼Œæ¯”å¦‚Chromeå’ŒFirefoxï¼Œä¼šåœ¨è¯·æ±‚å‘å‡ºå‰æ‹¦æˆªã€‚</p>

<p>å¸¸ç”¨çš„è·¨åŸŸè¯·æ±‚åœºæ™¯æ˜¯ï¼šä½¿ç”¨ XMLHttpRequest æˆ– Fetchå‘èµ·è·¨ç«™ HTTP è¯·æ±‚ã€‚</p>

<h2 id="cors-è¿‡ç¨‹ç†è§£">CORS è¿‡ç¨‹ç†è§£</h2>

<p>é¦–å…ˆæ˜ç¡®ï¼Œ<strong>CORS çš„å…³é”®æ˜¯æœåŠ¡å™¨</strong>ã€‚</p>

<p>æœ€ç®€å•çš„è¿‡ç¨‹ï¼š</p>

<ol>
<li>æµè§ˆå™¨å‘é€ CORS è¯·æ±‚ï¼Œåœ¨ header ä¸­æ·»åŠ ä¸€ä¸ª <code>Origin</code> å­—æ®µï¼Œå…¶å€¼ä¸ºè¯·æ±‚æºï¼ˆåè®®+åœ°å€+ç«¯å£ï¼‰</li>
<li>æœåŠ¡å™¨å“åº”ï¼Œå¹¶åœ¨ header ä¸­æ·»åŠ  <code>Access-Control-Allow-Origin</code> å­—æ®µ</li>
<li>æµè§ˆå™¨æ¥æ”¶ï¼Œåˆ¤æ–­ header æ¥ç¡®å®šæ˜¯å¦æ‹¦æˆª</li>
</ol>

<h2 id="cors-è¯·æ±‚">CORS è¯·æ±‚</h2>

<p>æµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†ä¸ºä¸¤ç±»ï¼Œç®€å•è¯·æ±‚å’Œé¢„è¯·æ±‚ã€‚</p>

<h3 id="ç®€å•è¯·æ±‚">ç®€å•è¯·æ±‚</h3>

<p>ç®€å•è¯·æ±‚çš„å®šä¹‰ï¼š</p>

<ul>
<li>åªä½¿ç”¨ GET, HEAD æˆ–è€… POST è¯·æ±‚æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨ POST  è¯·æ±‚æ—¶ï¼Œæ•°æ®ç±»å‹(Content-Type)åªèƒ½æ˜¯ application/x-www-form-urlencoded, multipart/form-data æˆ– text/plainä¸­çš„ä¸€ç§ã€‚</li>
<li>ä¸ä¼šä½¿ç”¨è‡ªå®šä¹‰è¯·æ±‚å¤´</li>
</ul>

<p>ç®€å•è¯·æ±‚çš„å“åº”å°±æ˜¯æœ€ç®€å•çš„è¿‡ç¨‹ï¼Œé€šè¿‡ä½¿ç”¨ Origin å’Œ Access-Control-Allow-Origin å°±å¯ä»¥å®Œæˆæœ€ç®€å•çš„è·¨ç«™è¯·æ±‚ã€‚</p>

<h3 id="é¢„è¯·æ±‚">é¢„è¯·æ±‚</h3>

<p>é¢„è¯·æ±‚å°±æ˜¯éç®€å•è¯·æ±‚ã€‚</p>

<p>é¢„è¯·æ±‚çš„é‡ç‚¹æ˜¯å¿…é¡»å‘é€ä¸€ä¸ª <code>OPTIONS</code> è¯·æ±‚ï¼Œæ¥ç¡®å®šæ˜¯å¦æ”¯æŒ CORSã€‚æµè§ˆå™¨ç¡®è®¤ä¹‹åï¼Œæ‰ä¼šå‘é€æ­£å¼è¯·æ±‚ã€‚åŸå› æ˜¯ä¼šå¯¹æœåŠ¡å™¨çš„æ•°æ®é€ æˆç ´åã€‚</p>

<p><strong>è¯·æ±‚è¿‡ç¨‹ï¼š</strong></p>

<p>å‘é€ä¸€ä¸ª <code>OPEIONS</code> è¯·æ±‚ã€‚ä¸€åŒå‘é€çš„è¿˜åŒ…æ‹¬ä¸‰ä¸ªè¯·æ±‚å¤´ï¼š</p>

<ul>
<li>Origin - æºåœ°å€</li>
<li>Access-Control-Request-Method - è·¨åŸŸè¯·æ±‚çš„ HTTP æ–¹æ³•åˆ—è¡¨</li>
<li>Access-Control-Request-Headers - è·¨åŸŸè¯·æ±‚å°†å‘é€çš„è‡ªå®šä¹‰å¤´ä¿¡æ¯</li>
</ul>

<p>æœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”ã€‚å¹¶ä¸”è¿”å›äº†ç›¸åº”çš„å“åº”å¤´ï¼š</p>

<ul>
<li>Access-Control-Allow-Origin</li>
<li>Access-Control-Allow-Methods</li>
<li>Access-Control-Allow-Headers</li>
<li>Access-Control-Allow-Credentials</li>
<li>Access-Control-Max-Age</li>
</ul>

<p>ä¹‹åçš„æ­£å¸¸è¯·æ±‚ï¼Œä¸ç®€å•è¯·æ±‚ç›¸åŒã€‚</p>

<h2 id="http-è¯·æ±‚å¤´">HTTP è¯·æ±‚å¤´</h2>

<h3 id="origin">Origin</h3>

<p>è¯·æ±‚çš„æºåœ°å€ï¼ŒåŒ…å«è¯·æ±‚çš„åè®®ï¼Œåœ°å€ï¼Œä»¥åŠç«¯å£</p>

<p>ä¸é™äº CORS è¯·æ±‚ï¼Œæ™®é€šè¯·æ±‚ä¹Ÿä¼šæºå¸¦</p>

<p>å½“ Origin çš„å€¼ä¸º null æ—¶ï¼Œè¡¨ç¤ºè¯·æ±‚åœ°å€ä¸ºæœ¬åœ°</p>

<h3 id="access-control-request-method">Access-Control-Request-Method</h3>

<p>åœ¨å‘é€é¢„è¯·æ±‚ä¸­æºå¸¦</p>

<p>å‘Šè¯‰æœåŠ¡å™¨åœ¨æ­£å¼è¯·æ±‚æ—¶ä½¿ç”¨çš„ HTTP æ–¹æ³•</p>

<h3 id="access-control-request-headers">Access-Control-Request-Headers</h3>

<p>åœ¨å‘é€é¢„è¯·æ±‚ä¸­æºå¸¦</p>

<p>å‘Šè¯‰æœåŠ¡å™¨åœ¨æ­£å¼è¯·æ±‚æ—¶ä¼šæºå¸¦çš„è‡ªå®šä¹‰å¤´ä¿¡æ¯ã€‚</p>

<p>å¤šä¸ªå€¼ï¼Œä½¿ç”¨é€—å·åˆ†å¼€</p>

<h2 id="http-å“åº”å¤´">HTTP å“åº”å¤´</h2>

<h3 id="access-control-allow-origin">Access-Control-Allow-Origin</h3>

<p>æœåŠ¡å™¨å“åº”çš„å“åº”</p>

<p>å…è®¸è¯·æ±‚çš„ URL</p>

<p>å½“å€¼ä¸º <code>*</code> æ—¶ï¼Œæ¥å—ä»»æ„åœ°å€çš„è¯·æ±‚</p>

<h3 id="access-control-expose-headers">Access-Control-Expose-Headers</h3>

<p>å…è®¸è¯·æ±‚çš„è‡ªå®šä¹‰å¤´</p>

<h3 id="access-control-max-age">Access-Control-Max-Age</h3>

<p>é¢„è¯·æ±‚ç»“æœçš„æœ‰æ•ˆæœŸï¼Œåœ¨æœ‰æ•ˆæœŸå†…ï¼Œå‘é€éç®€å•è¯·æ±‚ï¼Œä¸éœ€è¦å†å‘é€é¢„è¯·æ±‚ã€‚</p>

<h3 id="access-control-allow-credentials">Access-Control-Allow-Credentials</h3>

<p>æ˜¯å¦å…è®¸å‘é€ Cookieå’ŒHTTPè®¤è¯ä¿¡æ¯</p>

<p>é¦–å…ˆï¼Œåœ¨è¯·æ±‚ä¸­è®¾ç½®</p>

<pre><code class="language-js">xhr.withCredentials = true;
</code></pre>

<p>ä½¿å¾— Cookies èƒ½éšè¯·æ±‚ä¸€åŒå‘é€</p>

<p>æœåŠ¡å™¨æ¥æ”¶å“åº”ï¼Œåœ¨å“åº”å¤´ä¸­åŒ…å« <code>Access-Control-Allow-Credentials: true</code> ã€‚</p>

<p>å¦‚æœå“åº”å¤´ä¸­æ²¡æœ‰è¯¥å­—æ®µï¼Œæµè§ˆå™¨ä¼šæŠŠå“åº”ç»“æœä¸¢å¼ƒï¼Œä¿è¯ä¿¡æ¯å®‰å…¨ã€‚</p>

<p><strong>ç‰¹åˆ«æ³¨æ„ï¼š</strong></p>

<p>å‘é€ Cookie æ—¶ï¼Œå¿…é¡»æŒ‡å®šå…è®¸è¯·æ±‚çš„åŸŸåã€‚</p>

<p>ä¸èƒ½è®¾ç½®ä¸º</p>

<pre><code>Access-Control-Allow-Origin: * 
</code></pre>

<h3 id="access-control-allow-methods">Access-Control-Allow-Methods</h3>

<p>åœ¨é¢„è¯·æ±‚çš„å“åº”ä¸­æºå¸¦</p>

<p>åœ¨æ­£å¼è¯·æ±‚æ—¶å¯ä½¿ç”¨çš„ HTTP æ–¹æ³•</p>

<h3 id="access-control-allow-headers">Access-Control-Allow-Headers</h3>

<p>åœ¨é¢„è¯·æ±‚çš„å“åº”ä¸­æºå¸¦</p>

<p>åœ¨æ­£å¼è¯·æ±‚æ—¶å¯ä½¿ç”¨çš„è‡ªå®šä¹‰HTTPè¯·æ±‚å¤´</p>

<h2 id="åœ¨æœåŠ¡å™¨ç«¯æ”¯æŒ-cors">åœ¨æœåŠ¡å™¨ç«¯æ”¯æŒ CORS</h2>

<p>ç›¸å…³ä¿¡æ¯ï¼Œå‚é˜… <a href="https://enable-cors.org/index.html">enable cross-origin resource sharing</a></p>

<h3 id="åœ¨-tomcat-ä¸­è®¾ç½®-cors">åœ¨ tomcat ä¸­è®¾ç½® CORS</h3>

<p>åœ¨é¡¹ç›®çš„ web.xml ä¸­æ·»åŠ è¿‡æ»¤å™¨ï¼š</p>

<pre><code class="language-xml">&lt;filter&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.catalina.filters.CorsFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre>

<p>æ›´å¤šå‚æ•°ï¼Œè¯·çœ‹ <a href="http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html#CORS_Filter">http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html#CORS_Filter</a></p>

<h3 id="åœ¨-nginx-ä¸­è®¾ç½®-cors">åœ¨ nginx ä¸­è®¾ç½® CORS</h3>

<p>è¯·ç›´æ¥å‚é˜…ï¼Œ<a href="https://enable-cors.org/server_nginx.html">https://enable-cors.org/server_nginx.html</a></p>

<h3 id="åœ¨-java-web-é¡¹ç›®ä¸­è‡ªå®šä¹‰-cors-è¿‡æ»¤å™¨">åœ¨ java web é¡¹ç›®ä¸­è‡ªå®šä¹‰ CORS è¿‡æ»¤å™¨</h3>

<p>ä¸€ä¸ªç®€å•çš„ CORS è¿‡æ»¤å™¨</p>

<pre><code class="language-java">package com.x.filter;
import java.io.IOException;
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletResponse;
import org.springframework.stereotype.Component;

@Component
public class SimpleCORSFilter implements Filter {

    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException {
        HttpServletResponse response = (HttpServletResponse) res;
        response.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);
        response.setHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;);
        response.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;POST, GET, OPTIONS, DELETE&quot;);
        response.setHeader(&quot;Access-Control-Max-Age&quot;, &quot;3600&quot;);
        response.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers,Authorization&quot;);
        chain.doFilter(req, res);
    }

    public void init(FilterConfig filterConfig) {}

    public void destroy() {}

}
</code></pre>

<p>è®°å¾—åœ¨ web.xml ä¸­é…ç½®</p>

<pre><code class="language-xml">  &lt;!--CORS è¿‡æ»¤å™¨--&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;CORSFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;com.x.filter.SimpleCORSFilter&lt;/filter-class&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;CORSFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
</code></pre>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a>ã€‚</li>
<li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£</a></li>
<li><a href="https://www.w3.org/TR/cors/">https://www.w3.org/TR/cors/</a></li>
</ul>

</div>

<link href="http://hugo.xizero.com/css/footer.css" rel="stylesheet">

<div class="footer">
	<div class="_hr"><span></span></div>
	@XIZERO Powered by <a href="http://hugo.spf13.com/">Hugo</a> and <a href="#">bigbig</a>
</div>

</body>
</html>

